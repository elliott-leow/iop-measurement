data = [278.00, 278.00, 275.00, 273.00, 271.00, 272.00, 273.00, 273.00, 275.00, 277.00, 279.00, 280.00, 280.00, 282.00, 283.00, 282.00, 282.00, 282.00, 280.00, 280.00, 278.00, 276.00, 274.00, 273.00, 273.00, 272.00, 272.00, 274.00, 274.00, 275.00, 276.00, 277.00, 279.00, 280.00, 281.00, 282.00, 281.00, 283.00, 281.00, 280.00, 279.00, 278.00, 275.00, 274.00, 274.00, 273.00, 272.00, 272.00, 272.00, 273.00, 274.00, 274.00, 275.00, 277.00, 278.00, 279.00, 280.00, 280.00, 280.00, 280.00, 279.00, 278.00, 276.00, 276.00, 273.00, 273.00, 273.00, 272.00, 272.00, 272.00, 272.00, 273.00, 274.00, 277.00, 277.00, 278.00, 277.00, 279.00, 280.00, 280.00, 279.00, 278.00, 277.00, 276.00, 275.00, 275.00, 274.00, 273.00, 272.00, 272.00, 273.00, 273.00, 274.00, 274.00, 275.00, 275.00, 277.00, 278.00, 278.00, 279.00, 278.00, 278.00, 278.00, 277.00, 277.00, 274.00, 275.00, 274.00, 273.00, 274.00, 273.00, 273.00, 273.00, 274.00, 274.00, 275.00, 277.00, 277.00, 278.00, 279.00, 278.00, 279.00, 279.00, 278.00, 278.00, 277.00, 277.00, 276.00, 275.00, 274.00, 275.00, 274.00, 273.00, 273.00, 275.00, 276.00, 276.00, 277.00, 278.00, 278.00, 280.00, 279.00, 279.00, 278.00, 278.00, 279.00, 278.00, 277.00, 277.00, 276.00, 275.00, 274.00, 275.00, 275.00, 276.00, 276.00, 276.00, 277.00, 278.00, 278.00, 277.00, 278.00, 279.00, 279.00, 279.00, 278.00, 278.00, 277.00, 276.00, 276.00, 275.00, 276.00, 276.00, 275.00, 275.00, 274.00, 277.00, 275.00, 276.00, 276.00, 277.00, 279.00, 278.00, 278.00, 278.00, 277.00, 277.00, 277.00, 277.00, 276.00, 276.00, 276.00, 275.00, 273.00, 274.00, 274.00, 275.00, 274.00, 276.00, 276.00, 276.00, 277.00, 276.00, 276.00, 277.00, 277.00, 277.00, 279.00, 277.00, 275.00, 275.00, 275.00, 277.00, 275.00, 274.00, 274.00, 274.00, 275.00, 274.00, 275.00, 275.00, 276.00, 276.00, 276.00, 277.00, 277.00, 275.00, 277.00, 276.00, 277.00, 276.00, 276.00, 274.00, 274.00, 275.00, 275.00, 274.00, 274.00, 274.00, 274.00, 275.00, 275.00, 276.00, 276.00, 276.00, 276.00, 276.00, 276.00, 278.00, 277.00, 277.00, 276.00, 276.00, 277.00, 275.00, 274.00, 275.00, 275.00, 276.00, 275.00, 275.00, 276.00, 276.00, 277.00, 276.00, 277.00, 278.00, 277.00, 278.00, 277.00, 276.00, 278.00, 277.00, 277.00, 277.00, 277.00, 276.00];

Fs = 32768/4;         % Sampling frequency                    
T = 1/Fs;             % Sampling period       
L = length(data);     % Length of signal
t = (0:L-1)*T;        % Time vector

%determine the steady state
steadyState = mean(data)
%find all peaks of the data
[maxima,locations] = findpeaks(data,t,'MinPeakWidth',0.0005,'MinPeakHeight',steadyState);

%to visualize where the peaks are
findpeaks(data,t,'MinPeakWidth',0.0005,'MinPeakHeight',steadyState)
text(locations,maxima,num2str((1:numel(maxima))'))


%find damping constant by linearizing the peaks then linear fitting
maxima = log(maxima-steadyState);
p = polyfit(locations,maxima,1);
damping = -p(1);

%fft the data
Y = fft(data);


%find the frequency of the signal by taking the peak of the fft
[fftPeaks, fftLocations] = findpeaks(abs(Y),'SortStr','descend');
freq = Fs/L*(fftLocations(1) - 1);

%plot curve
experimetal = -((max(data)-min(data))/2)*sin(2*3.14159*freq*t).*exp(-damping*t)+steadyState;



fig1 = figure(1);
hold on
plot(t,data)
hold off
hold on
plot(t,experimetal)
hold off
title("Infrared Sensor Input")
xlabel("t (s)")
ylabel("analog measurement")

fig2 = figure(2);
plot(Fs/L*(0:L-1),abs(Y),"LineWidth",3)
title("Complex Magnitude of fft Spectrum")
xlabel("f (Hz)")
ylabel("|fft(X)|")

fig3 = figure(3);
plot(locations,maxima)